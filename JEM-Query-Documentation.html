<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Juliana Spector" />


<meta name="progressive" content="true" />
<meta name="allow-skip" content="true" />

<title>JEM Query Documentation</title>


<!-- highlightjs -->
<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>

<!-- taken from https://github.com/rstudio/rmarkdown/blob/67b7f5fc779e4cfdfd0f021d3d7745b6b6e17149/inst/rmd/h/default.html#L296-L362 -->
<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>
<!-- end tabsets -->



</head>

<body>



<div class="pageContent band">
<div class="bandContent page">

<div class="topics">

<div id="section-welcome" class="section level2">
<h2>Welcome</h2>
<p>From this documentation, you will learn how to use the JEM Query, including:</p>
<ul>
<li>How to use a shapefile (or query Water49 from ArcGIS server) to delineate watershed boundary from which to extract points of diversion<br />
</li>
<li>How to download documents (for statements of diversion and use, appropriative water rights, and appropriative state filings) from Electronic Water Rights Management System (eWRIMS) associated with water rights of interest</li>
<li>How to build a simple SQLite database to query if scanned and georeferenced maps are already available for desired water right records</li>
<li>How to generate a table with water right information for records of interest based on eWRIMS flat files</li>
</ul>
<p>The script author acknowledges important contributions from Will Anderson and Angela Kwon for ideas related to using utils package for downloading eWRIMS documents and using data.table package to read and process eWRIMS flat file data.</p>
</div>
<div id="section-setup" class="section level2">
<h2>Setup</h2>
<div id="section-required-packages" class="section level3">
<h3>Required Packages</h3>
<p>The JEM Query requires the following CRAN packages as dependencies, if using locally provided shapefile(s):</p>
<pre class="r"><code>library(sf) # for reading shapefiles and attribute tables
library(tools) # for reading file names without extensions
library(utils) # for opening eWRIMS web and downloading documents
library(janitor) # for %&gt;% operator
library(rstudioapi) #for setting working directory to script location
library(data.table) # for reading eWRIMS flat files
library(DBI) # for building and querying SQLite database
library(tidyverse) # for cleaning data</code></pre>
<p>If querying a Hydrologic Unit Code (HUC) boundary from Water49, the other additional CRAN packages necessary are:</p>
<pre class="r"><code>library(arcgisbinding) # for connecting to Water49 in ArcGIS server through R
library(svDialogs) # generates dialog boxes for SQL query of HUC layer in Water49</code></pre>
</div>
<div id="section-locally-available-shapefiles-and-data" class="section level3">
<h3>Locally Available Shapefiles and Data</h3>
<p>For ease of accessing locally available shapefiles and data, the JEM Query sets working directory to script location path. All shapefiles and data should be available within a www/ sub-directory.</p>
</div>
<div id="section-set-up-google-chrome" class="section level3">
<h3>Set up Google Chrome</h3>
<p>You need to set up Google Chrome as default browser within computer settings and select where Chrome will download any files from eWRIMS online database in advanced settings. See screenshots below:</p>
<div class="figure">
<img src="images/Set_Default_Browser.png" alt="Set default browser to Google Chrome in Windows 10 within Computer Settings --&gt; Apps --&gt; Default apps --&gt; Web browser" width="100%" />
<p class="caption">
Set default browser to Google Chrome in Windows 10 within Computer Settings –&gt; Apps –&gt; Default apps –&gt; Web browser
</p>
</div>
<p>Follow these instructions in Google Chrome to stop PDF files from automatically opening in system viewer after download and set your download location.</p>
<ol style="list-style-type: decimal">
<li>Open Chrome Settings</li>
<li>Expand Advanced</li>
<li>Select Downloads</li>
<li>Set location for downloaded files</li>
<li>Select Clear next to “Open certain file types automatically after downloading”. If you don’t see this, your browser was not set to “Always open with system viewer”.</li>
<li>Go to Privacy and security</li>
<li>Expand Site Settings</li>
<li>Click on PDF Documents</li>
<li>Make sure “Download PDF files” instead of automatically opening them in Chrome is enabled.</li>
</ol>
<div class="figure">
<img src="images/Select_Download_Location.png" alt="Set download location within Google Chrome at Settings --&gt; Advanced --&gt; Downloads --&gt; Location" width="100%" />
<p class="caption">
Set download location within Google Chrome at Settings –&gt; Advanced –&gt; Downloads –&gt; Location
</p>
</div>
</div>
<div id="section-fill-in-necessary-directory-paths" class="section level3">
<h3>Fill in necessary directory paths</h3>
<p>User should go through script prior to execution and fill in necessary directory paths. You need to pre-define two separate paths (Google Chrome default download location and where maps identified from eWRIMS will be stored). There are three lines of script that need paths filled in.</p>
</div>
<div id="section-readkey-function" class="section level3">
<h3><code>readKey</code> function</h3>
<p>The <code>readKey</code> function allows user to pause the script after watershed area has been defined, points of diversion determined, and documents from eWRIMS downloaded. Then user can determine which documents have maps and place in pre-defined directory. In order for <code>read_key</code> function to pause script appropriately, user should use SOURCE button if running the entire script (as opposed to RUN button).</p>
<pre class="r"><code>readKey &lt;- function() {
  line &lt;- readline(prompt=&quot;Press [enter] to continue&quot;)
}</code></pre>
</div>
</div>
<div id="section-determine-watershed-boundary" class="section level2">
<h2>Determine watershed boundary</h2>
<div id="section-using-locally-provided-shapefiles-for-watershed-boundary" class="section level3">
<h3>Using locally provided shapefiles for watershed boundary</h3>
<div id="section-depending-on-sf-and-dplyr-packages" class="section level4">
<h4>Depending on sf and dplyr packages</h4>
<p>The methodology for using locally provided shapefiles was developed as a result of extended telework situation during COVID-19 pandemic. Staff without access to VPN will need to access locally saved shapefiles in /www subdirectory to determine watershed boundary.</p>
<p><code>st_read</code> reads locally saved shapefiles for geometry and attributes and <code>st_transform</code> can transform a shapefile’s coordinate reference system. <code>filter</code> selects relevant records based on watershed name. <code>st_difference</code> finds area in first argument not in second argument.</p>
<p>Here is a more complicated example encountered for Mokelumne River watershed. In this case, we wanted to use Upper Mokelumne River watershed from HUC-8 boundaries, but wanted to exclude any water right records that fell within the Legal Delta boundaries (as POU is being already mapped in detail for this area by Office of Delta Watermaster).</p>
<pre class="r"><code>legalDelta &lt;- st_read(&#39;Legal_Delta.shp&#39;)
hu_8 &lt;-  st_read(&#39;WBDHU8.shp&#39;)

# transform shapefiles used into same coordinate system
legalDelta &lt;- st_transform(legalDelta, crs = 4326)
hu_8 &lt;- st_transform(hu_8, crs = 4326)

MOK &lt;- hu_8 %&gt;% filter(Name == &#39;Upper Mokelumne&#39;)

watershed &lt;- st_difference(MOK, legalDelta)</code></pre>
<p>The HUC boundaries can be obtained online from <a href="ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/WBD/HU2/Shape/">USGS National Hydrography Dataset</a> (in event that user does not have access to Water49).</p>
<p>For each watershed, you will need to use different HUC boundaries and/or additional shapefiles to define your boundary. You can map boundaries and examine attributes in ArcGIS to determine desired watershed.</p>
</div>
</div>
<div id="section-using-water49-for-watershed-boundary" class="section level3">
<h3>Using Water49 for watershed boundary</h3>
<p>The JEM Query was originally designed to connect with Water49 on the ArcGIS server and query existing layers. The user will need to set up the <a href="https://github.com/R-ArcGIS/r-bridge">R-ArcGIS Bridge</a> in order to use the following code.</p>
<p>The user can use desired HUC layer and OBJECTID (selected through dialog boxes) to query HUC layer for watershed boundary. In comments there is an additional example of selecting a watershed boundary made up of two separate OBJECTIDs.</p>
<pre class="r"><code># run this line before using arcgisbinding pkg, should receive a successful connection to ArcGIS server message in console
arc.check_product()

# open HUC layers from Water49
# will need to set path for individual user

hu_10 &lt;-
  arc.open(
    &quot;C:/Users/USERNAME/AppData/Roaming/ESRI/Desktop10.6/ArcCatalog/Connection to water49db.sde/WBGIS.WatershedBoundaryDatasetApr2016/WBGIS.WBDHU10_041216&quot;
  )
hu_12 &lt;-
  arc.open(
    &quot;C:/Users/USERNAME/AppData/Roaming/ESRI/Desktop10.6/ArcCatalog/Connection to water49db.sde/WBGIS.WatershedBoundaryDatasetApr2016/WBGIS.WBDHU12_041216&quot;
  )
hu_8 &lt;-
  arc.open(
    &quot;C:/Users/USERNAME/AppData/Roaming/ESRI/Desktop10.6/ArcCatalog/Connection to water49db.sde/WBGIS.WatershedBoundaryDatasetApr2016/WBGIS.WBDHU8_041216&quot;
  )

# Choose watershed
# enter HUC chosen
huc &lt;-
  dlgInput(&quot;Enter &#39;hu_10&#39;, &#39;hu_12&#39;, or &#39;hu_8.&#39;&quot;, Sys.info()[&quot;huc&quot;])$res

# enter OBJECTID for watershed of interest based on HUC chosen
objid &lt;- dlgInput(&quot;Enter Object ID.&quot;, Sys.info()[&quot;objid&quot;])$res

#If you need to select multiple watershed areas, can enter a second OBJECTID
#objid_2 &lt;- dlgInput(&quot;Enter Object ID.&quot;, Sys.info()[&quot;objid_2&quot;])$res

# Selecting watershed with SQL query
watershed &lt;-
  arc.select(object = get(huc),
             where_clause = paste0(&quot;OBJECTID =&quot;, objid, &quot;&quot;))

# Example of SQL query with multiple watersheds selected
#watershed &lt;- arc.select(object=get(huc), where_clause= paste0(&quot;OBJECTID =&quot;,objid_1,&quot; OR OBJECTID=&quot;,objid_2,&quot;&quot;))</code></pre>
<p>In addition to looking at HUC layers in ArcGIS to determine watershed boundaries, one can also use another tool, <a href="https://cawaterboards.sharepoint.com/:u:/r/DWR/MITWG/Documents/Project%20-%20POU/Division_Document_Deliverables/Documentation/Reference%20Materials/R%20Code/HUC_Visualization_App.R?csf=1&amp;web=1&amp;e=yeXh60">HUC_Visualization_App.R</a>, developed as a basic R Shiny app. This tool allows the user to visualize watersheds according to HUC 8, 10, and 12 boundaries, but code could likely be easily altered for other mapping visualizations.</p>
<p>The code for HUC_Visualization_App.R was written with access to Water49 in mind, but could be adapted to work with local shapefiles using the <code>st_read</code> and <code>st_transform</code> functions as demonstrated earlier in documentation.</p>
</div>
</div>
<div id="section-determine-pods-in-watershed" class="section level2">
<h2>Determine PODs in watershed</h2>
<p>This part of the code is wrapped in a function (<code>correctSQL</code>) to return an error (and stop script) if an incorrect SQL query caused the <code>watershed</code> variable to return 0 records.</p>
<p>This section will start to break down the code in the <code>correctSQL</code> function. The code for <code>JEM_Query_Local.R</code> and <code>JEM_Query_Water49_Access.R</code> differ only in whether the points of diversion are read in from a local shapefile (copy from Water49 provided to ICF on 2/14/2020) or from the POD layer on Water49.</p>
<p>Layers in Water49 can change names over time, so it may be necessary to check that layer name in script corresponds to Water49. The cornerstone to both approaches is the <code>st_intersection</code> function that will find points of diversion (PODs) within watershed boundary.</p>
<p>Relevant parts of code from <code>JEM_Query_Local.R</code>:</p>
<pre class="r"><code>  POD &lt;- st_read(&quot;www/20200214_WBGIS_POD.shp&quot;)
  
  # make sure POD and watershed are in same coordinate system
  POD &lt;- st_transform(POD, crs = 4326)
  watershed &lt;- st_transform(watershed, crs = 4326)
  
  # find PODs within watershed
  # &#39;&lt;&lt;-&#39; will write variable to global environment within function
  POD_in_watershed &lt;&lt;- st_intersection(POD, watershed)</code></pre>
<p>Relevant parts of code from <code>JEM_Query_Water49_Access.R</code>:</p>
<pre class="r"><code>  # open PODs from Water49, will need to amend file path for individual user
  POD &lt;-
    arc.open(
      &quot;C:/Users/USERNAME/AppData/Roaming/ESRI/Desktop10.6/ArcCatalog/Connection to water49db.sde/WBGIS.POINTS_OF_DIVERSION&quot;
    )
  
  # make PODs accessible
  POD &lt;- arc.select(object = POD)
  
  # convert to sf objects
  POD &lt;- arc.data2sf(POD)
  watershed &lt;- arc.data2sf(watershed)
  
  # make sure POD and watershed are in same coordinate system
  POD &lt;- st_transform(POD, crs = 4326)
  watershed &lt;- st_transform(watershed, crs = 4326)
  
  # find PODs within watershed
  # &#39;&lt;&lt;-&#39; will write variable to global environment within function
  POD_in_watershed &lt;&lt;- st_intersection(POD, watershed)</code></pre>
</div>
<div id="section-recode-application-ids-for-state-filings-and-domestic-water-rights" class="section level2">
<h2>Recode application IDs for state filings and domestic water rights</h2>
<p>The POD layer from Water49 has some inconsistencies with eWRIMS flat files and database, with regard to application IDs for state filings and domestic water rights. POD layer does not include “SF” at end of application ID for state filings and adds an “R” at end of domestic water right application IDs. This causes issues with downloading documents from eWRIMS and joining with flat file data later in the script. Therefore these lines of code within the <code>correctSQL</code> function assist with recoding these application IDs from POD layer:</p>
<pre class="r"><code>  # now get list of all application IDs in eWRIMS
  
  flatFULL &lt;-
    fread(
      &quot;www/ewrims_flat_file.csv&quot;,
      header = TRUE,
      stringsAsFactors = FALSE,
      data.table = FALSE,
      blank.lines.skip = TRUE
    )
  flat &lt;- flatFULL
  
  app_numbers &lt;- sort(unique(POD_in_watershed$APPL_ID))
  app_numbers &lt;- as.character(app_numbers)
  
  flat &lt;- data.frame(flat[, c(2)])
  colnames(flat) &lt;- c(&quot;APPL_ID&quot;)
  # determine SF APPL_IDs
  SF &lt;- filter(flat, grepl(&#39;SF&#39;, APPL_ID))
  
  # if first 7 characters of APPL_ID match, add SF to ending
  add_SF &lt;- intersect(app_numbers, substr(SF$APPL_ID, 1, 7))
  add_SF_recode &lt;- paste0(add_SF, &quot;SF&quot;)
  app_numbers_recoded &lt;-
    data.frame(add_SF_recode[match(app_numbers, add_SF)])
  
  df &lt;- cbind(app_numbers_recoded, app_numbers)
  df &lt;- df %&gt;% mutate_all(as.character)
  colnames(df) &lt;- c(&quot;recoded&quot;, &quot;original&quot;)
  df$recoded[is.na(df$recoded)] &lt;- df$original[is.na(df$recoded)]
  
  app_numbers &lt;- df$recoded
  
  # remove R from end of domestic statements, otherwise cannot link with flat file
  
  app_numbers &lt;&lt;- sub(&quot;R$&quot;, &quot;&quot;, app_numbers)</code></pre>
</div>
<div id="section-download-relevant-ewrims-documents" class="section level2">
<h2>Download relevant eWRIMS documents</h2>
<p>Now that we have the application IDs corrected, we can now download relevant documents from eWRIMS online database. First we generate the list of links to which the web browser will navigate. Web link generators have been set up for Statements of Diversion and Use, Appropriative, and Appropriative (State Filing) based on what links on eWRIMS have previously yielded documents.</p>
<p>Then we navigate to the linked web pages. This process will take awhile depending on how many PODs are within the watershed. Documents will be downloaded to the download path defined within Google Chrome (see Setup page for more details).</p>
<pre class="r"><code>  POD_in_watershed$link &lt;- character(length(nrow(POD_in_watershed)))
  
  link &lt;-
    function(x, y) {
      paste0(
        &quot;https://ciwqs.waterboards.ca.gov/ciwqs/ewrims/DocumentRetriever.jsp?appNum=&quot;,
        x,
        &quot;&amp;wrType=&quot;,
        y
      )
    }
  
  S_links &lt;-
    sapply(app_numbers[startsWith(app_numbers, &quot;S&quot;)], link, &quot;Statement%20of%20Div%20and%20Use&quot;)
  A_links &lt;-
    sapply(app_numbers[startsWith(app_numbers, &quot;A&quot;)], link, &quot;Appropriative&quot;)
  SF_links &lt;-
    sapply(app_numbers[endsWith(app_numbers, &quot;SF&quot;)], link, &quot;Appropriative (State Filing)&quot;)
  
  
  for (i in 1:length(A_links)) {
  browseURL(A_links[i])
  }

  for (i in 1:length(S_links)) {
  browseURL(S_links[i])
  }

  for (i in 1:length(SF_links)) {
  browseURL(SF_links[i])
  }</code></pre>
</div>
<div id="section-were-all-possible-ewrims-documents-downloaded" class="section level2">
<h2>Were all possible eWRIMS documents downloaded?</h2>
<p>This last part of the <code>correctSQL</code> function serves as a check that all possible documents from eWRIMS were downloaded. Generally, you can check that variable <code>total_WR</code> is equivalent to number of PODs within watershed. If not, it is possible that some documents were unavailable for download on eWRIMS and you can check to which application IDs that may be applicable. It is a confirmation that documents were unavailable as opposed to not downloaded due to server timeout or similar issue.</p>
<pre class="r"><code>  # generate a count to see if all docs possible were downloaded from eWRIMS
  c &lt;- sum(startsWith(app_numbers, &quot;C&quot;))
  d &lt;- sum(startsWith(app_numbers, &quot;D&quot;))
  f &lt;- sum(startsWith(app_numbers, &quot;F&quot;))
  l &lt;- sum(startsWith(app_numbers, &quot;L&quot;))
  x &lt;- sum(startsWith(app_numbers, &quot;X&quot;))
  
  # directory is where statements/applications were downloaded
  a &lt;-
    sum(startsWith(setdiff(
      app_numbers, file_path_sans_ext(list.files(&quot;ENTER DIRECTORY PATH HERE&quot;))
    ), &quot;A&quot;))
  s &lt;-
    sum(startsWith(setdiff(
      app_numbers, file_path_sans_ext(list.files(&quot;ENTER DIRECTORY PATH HERE&quot;))
    ), &quot;S&quot;))
  
  
  total_WR &lt;&lt;- a + c + d + f + l + s + x</code></pre>
<p>After <code>correctSQL</code> function finishes executing, the <code>readKey</code> function is called to pause script and allow user to determine which downloaded documents have maps and to copy those documents to a new directory. Documents should be named by application ID.</p>
<p>User can manually look through documents to identify those with maps or possibly adapt upon work developed to use image entropy classification (see <a href="https://cawaterboards.sharepoint.com/:u:/r/DWR/MITWG/Documents/Project%20-%20POU/Division_Document_Deliverables/Documentation/Reference%20Materials/Image%20Entropy%20Classification/Image_Entropy_Filtering_Script.py?csf=1&amp;web=1&amp;e=mOoKgh">Image_Entropy_Filtering_Script.py</a>) or machine learning (see <a href="https://cawaterboards.sharepoint.com/:u:/r/DWR/MITWG/Documents/Project%20-%20POU/Division_Document_Deliverables/Documentation/Reference%20Materials/Machine%20Learning/Machine_Learning_Recognize_Docs_Maps.py?csf=1&amp;web=1&amp;e=w9JsE6">Machine_Learning_Recognize_Docs_Maps.py</a>).</p>
</div>
<div id="section-determine-which-maps-have-already-been-scanned" class="section level2">
<h2>Determine which maps have already been scanned</h2>
<p>After eWRIMS documents with maps have been identified and associated directory has been added to script, user can then press ENTER in console to continue script.</p>
<p>At this point, the JEM Query will now build a SQLite database based on lookup tables of application IDs associated with various collections of pre-scanned maps. <a href="https://cawaterboards.sharepoint.com/:w:/r/DWR/MITWG/Documents/Project%20-%20POU/Division_Document_Deliverables/Documentation/Data%20Management/Legacy%20Scanned%20and%20Georeferenced%20Map%20Locations%20on%20S%20Drive.docx?d=w01d619ce5b90429aa884690650380a18&amp;csf=1&amp;web=1&amp;e=eaHTuc">Documentation</a> on MITWG Sharepoint describes locations of legacy maps on shared drive.</p>
<pre class="r"><code># directory will contain eWRIMS documents with PDF maps named by APPL_ID
# will need to look through all documents downloaded to determine which ones have maps
eWRIMS_available &lt;-
  data.frame(file_path_sans_ext(list.files(&#39;ENTER DIRECTORY PATH HERE&#39;)))
eWRIMS_available &lt;- eWRIMS_available %&gt;% rename(APPL_ID = 1)
eWRIMS_available$Available_eWRIMS &lt;- &#39;Y&#39;

georeferenced_maps &lt;-
  read.csv(&#39;www/Georeferenced_Legacy_Maps.csv&#39;)
georeferenced_maps &lt;- georeferenced_maps %&gt;% select(&quot;APPL_ID&quot;)
georeferenced_maps$Georeferenced &lt;- &#39;Y&#39;

license_maps &lt;-
  read.csv(&#39;www/Scanned_Licensing_Maps.csv&#39;)
license_maps &lt;- license_maps %&gt;% rename(APPL_ID = 2)
license_maps &lt;- license_maps %&gt;% select(APPL_ID)
license_maps$License_Legacy &lt;- &#39;Y&#39;

legacy_maps &lt;-
  read.csv(&#39;www/Scanned_Legacy_Maps.csv&#39;)
legacy_maps &lt;-
  legacy_maps %&gt;% rename(APPL_ID = ApplicationNumber) %&gt;% select(APPL_ID)
legacy_maps &lt;- unique(legacy_maps)
legacy_maps$Legacy_Scanned &lt;- &#39;Y&#39;

database_table &lt;- left_join(BayDelta_masterlist, eWRIMS_available)
database_table &lt;- left_join(database_table, georeferenced_maps)
database_table &lt;- left_join(database_table, license_maps)
database_table &lt;- left_join(database_table, legacy_maps)
database_table[is.na(database_table)] &lt;- &#39;N&#39;

# Create an ephemeral in-memory RSQLite database and generate query ----
con &lt;- dbConnect(RSQLite::SQLite(), &quot;:memory:&quot;)

dbWriteTable(con, &quot;database_table&quot;, database_table)</code></pre>
</div>
<div id="section-query-sqlite-database-join-information-from-ewrims-flat-files" class="section level2">
<h2>Query SQLite database &amp; join information from eWRIMS flat files</h2>
<p>Now that the SQLite database has been built, it can be queried for watershed records of interest and then joined to information in eWRIMS flat files by application ID (including beneficial uses, water right types, primary owner, face value, status, and county).</p>
<pre class="r"><code>res &lt;- subset(database_table, APPL_ID %in% app_numbers)

# join APPL_IDs and availability information ----

POD_in_watershed &lt;- inner_join(POD_in_watershed, res)
# remove unnecessary variables from environments
rm(
  BayDelta_masterlist,
  eWRIMS_available,
  georeferenced_maps,
  license_maps,
  legacy_maps
)

# Load Data from eWRIMS Flat Files
flatFULL &lt;-
  fread(
    &quot;www/ewrims_flat_file.csv&quot;,
    header = TRUE,
    stringsAsFactors = FALSE,
    data.table = FALSE,
    blank.lines.skip = TRUE
  )
flat &lt;- flatFULL
flat &lt;- flat[, c(2, 21, 26, 6, 7, 118)]
colnames(flat) &lt;-
  c(&quot;APPL_ID&quot;,
    &quot;PRIMARY_OWNER&quot;,
    &quot;FACE_VALUE_AMOUNT_AF&quot;,
    &quot;WR_TYPE&quot;,
    &quot;STATUS&quot;,
    &quot;COUNTY&quot;)

usesFULL &lt;-
  fread(
    &quot;www/ewrims_flat_file_use_season.csv&quot;,
    header = TRUE,
    stringsAsFactors = FALSE,
    data.table = FALSE,
    blank.lines.skip = TRUE
  )
uses &lt;- usesFULL
uses &lt;-
  uses[, c(77, 5)] #select only columns for APPL_ID and USE_CODE
colnames(uses) &lt;- c(&quot;APPL_ID&quot;, &quot;BEN_USE&quot;)
uses &lt;-
  uses[order(uses$APPL_ID, uses$BEN_USE), ] # sort both columns in ascending order
uses &lt;-
  aggregate(BEN_USE ~ APPL_ID, data = uses, toString) # aggregate to have one row per APPL_ID with a list of uses

rip_pre1914 &lt;-
  read.csv(&quot;www/20200213_Riparian and Pre1914 eWRIMS pull.csv&quot;) #Riparian and Pre-1914 water rights info
rip_pre1914$ACC_DATE &lt;- NULL
rip_pre1914 &lt;- rip_pre1914[order(rip_pre1914$APPL_ID), ]
rip_pre1914 &lt;- rip_pre1914[!duplicated(rip_pre1914$APPL_ID), ]

table &lt;- merge(flat, uses, all = TRUE)
table &lt;-
  table[!(table$APPL_ID == &quot;&quot;), ] #remove water rights with no APPL_ID
table &lt;- merge(table, rip_pre1914, all = TRUE)
table &lt;- table %&gt;% replace_na(list(Riparian = &quot;&quot;, Pre1914 = &quot;&quot;))

rm(flatFULL, flat, usesFULL, uses) #remove other eWRIMS data because they&#39;re all merged into table</code></pre>
</div>
<div id="section-create-a-water-rights-summary-table" class="section level2">
<h2>Create a water rights summary table</h2>
<p>The code below shows an example of creating a water rights summary table for the Mokelumne River watershed. Bay-Delta team has used such tables to share with contractors which maps are already available and will not require scanning.</p>
<pre class="r"><code>#Table specific for Mokelumne River
MOK_table &lt;-
  POD_in_watershed[, c(1, 2, 64:68)] #APPL_ID, POD_ID, map tracking columns
MOK_table$geometry &lt;- NULL
MOK_table &lt;- MOK_table[order(MOK_table$APPL_ID, MOK_table$POD_ID), ]
MOK_table &lt;-
  aggregate(
    POD_ID ~ APPL_ID + Georeferenced + License_Legacy + Legacy_Scanned + Available_eWRIMS,
    data = MOK_table,
    toString
  )
MOK_table &lt;- merge(MOK_table, table, by = c(&quot;APPL_ID&quot;))
MOK_table$Watershed &lt;- &quot;Mokelumne River&quot;

write.csv(MOK_table, &quot;MOK_River_Water_Rights_Table.csv&quot;)
maps_available &lt;-
  MOK_table %&gt;% filter(
    Georeferenced == &#39;Y&#39; |
      License_Legacy == &#39;Y&#39; |
      Legacy_Scanned == &#39;Y&#39; | Available_eWRIMS == &#39;Y&#39;
  )</code></pre>
</div>
<div id="section-further-documentation" class="section level2">
<h2>Further Documentation</h2>
Refer to <a href="https://cawaterboards.sharepoint.com/:f:/r/DWR/MITWG/Documents/Project%20-%20POU/Division_Document_Deliverables/Documentation?csf=1&amp;web=1&amp;e=qLZ25o">MITWG Sharepoint site</a> or <a href="https://github.com/julianaspector/JEM_Query_Documentation">GitHub repository</a> for more information. 
<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
session$onSessionEnded(function() {
        learnr:::session_stop_event(session)
      })
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/cerulean.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["textmate.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-format"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmarkdown/templates/tutorial/resources"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-format.js"]},{"type":"character","attributes":{},"value":["tutorial-format.css","rstudio-theme.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["5.1.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/fontawesome"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/all.css","css/v4-shims.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["4.4.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["idb-keyvalue"]},{"type":"character","attributes":{},"value":["3.2.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/idb-keyval"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["idb-keyval-iife-compat.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]}},"value":[{"type":"character","attributes":{},"value":["backports","base","compiler","datasets","digest","evaluate","fastmap","graphics","grDevices","highr","htmltools","htmlwidgets","httpuv","jsonlite","knitr","later","learnr","magrittr","markdown","methods","mime","promises","R6","Rcpp","rlang","rmarkdown","rprojroot","shiny","stats","stringi","stringr","tools","utils","withr","xfun","xtable","yaml"]},{"type":"character","attributes":{},"value":["1.1.5","3.6.2","3.6.2","3.6.2","0.6.22","0.14","1.0.1","3.6.2","3.6.2","0.8","0.4.0","1.5.1","1.5.2","1.6.1","1.28","1.0.0","0.10.1","1.5","1.1","3.6.2","0.8","1.1.0","2.4.0","1.0.2","0.4.1","2.1","1.3-2","1.4.0","3.6.2","1.4.3","1.4.0","3.6.2","3.6.2","2.1.2","0.12","1.8-4","2.2.0"]}]}]}
</script>
<!--/html_preserve-->
</div>

</div> <!-- topics -->

<div class="topicsContainer">
<div class="topicsPositioner">
<div class="band">
<div class="bandContent topicsListContainer">

<!-- begin doc-metadata -->
<div id="doc-metadata">
<h2 class="title toc-ignore" style="display:none;">JEM Query Documentation</h2>
<h4 class="author"><em>Juliana Spector</em></h4>
</div>
<!-- end doc-metadata -->

</div> <!-- bandContent.topicsListContainer -->
</div> <!-- band -->
</div> <!-- topicsPositioner -->
</div> <!-- topicsContainer -->


</div> <!-- bandContent page -->
</div> <!-- pageContent band -->




<script>
// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>


</body>

</html>
